---
title: "gloBarAnalysis"
author: "ian enochs"
date: "2024-03-10"
output:
  pdf_document: default
  html_document: default
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### GLOBAL BMU Analysis
This document was created to analyze NCRMP BMU data

```{r, echo=FALSE}
library(readxl)
library(dplyr)
library(magrittr)
library(ggplot2)
library(ggpubr)
library(lubridate)

#get data
rootFolder <-getwd() #get root folder
atlanticBarData_raw <- read_excel(paste(rootFolder,"/data/NCRMP_Atlantic_allBmuData_March2024.xlsx",sep=""))#import data
pacificBarData_raw <- read_excel(paste(rootFolder,"/data/NCRMP_Pacific_allBmuData_March2024.xlsx",sep=""))#import data
allBarData_raw <- rbind(atlanticBarData_raw, pacificBarData_raw)
allBarData_clean <- allBarData_raw %>% 
  filter(fate=='SUCCESSFULLY RECOVERED') %>% #remove bars that weren't recovered
  filter(species!='Isopora sp.') %>% #remove bars made of Isopora
  select(-c(dimensions,carbMDPre, carbEQPre, carbMDPost,carbEQPre)) %>% #remove unnecessary columns
  mutate(daysDeployed = as.numeric(ymd(dateRecovery) - ymd(dateDeployment))) %>% 
  mutate(yearsDeployed=daysDeployed/365)

#standardize data to surface area and days.
preSA = 24 #cm2 of exterior facing bar in a 2 x 1 x 5 cm block
allBarData_clean <- allBarData_clean  %>% 
  mutate(deltaMass_mgcm2y = 1000*(massCleanPost-massEpoxiedPre)/preSA/yearsDeployed) %>%  
  mutate(deltaVolume_mm3cm2y = 1000*(volumeBlockPost-volumeBlockPre)/preSA/yearsDeployed) %>%  
  mutate(deltaDensity_mgcm3cm2y = 1000*(densityCTPost-densityCTPre)/preSA/yearsDeployed) %>%  
  mutate(macroboring_mm3cm2y = 1000*macroboring/preSA/yearsDeployed) %>%  
  mutate(accretion_mm3cm2y = 1000*accretion/preSA/yearsDeployed) %>% 
  mutate(grazing_mm3cm2y = 1000*grazing/preSA/yearsDeployed)
```

## QA/QC of deltaMass_mgcm2y
Tags where deltaMass_mgcm2y = "NA":
```{r, echo=FALSE}
  allBarData_clean$tagNum[which(is.na(allBarData_clean$deltaMass_mgcm2y))]
```
Historgram of deltaMass_mgcm2y values
```{r, echo=FALSE}
  ggplot(allBarData_clean, aes(x = deltaMass_mgcm2y)) +
  geom_histogram(binwidth = 5, color = "black", fill = "white") +
  labs(title = "Histogram of deltaMass_mgcm2y", x = "deltaMass_mgcm2y", y = "Frequency")
```

## QA/QC of deltaVolume_mm3cm2y
Tags where deltaVolume_mm3cm2y = "NA":
```{r, echo=FALSE}
allBarData_clean$tagNum[which(is.na(allBarData_clean$deltaVolume_mm3cm2y))]
```
Historgram of deltaVolume_mm3cm2y values
```{r, echo=FALSE}
  ggplot(allBarData_clean, aes(x = deltaVolume_mm3cm2y)) +
  geom_histogram(binwidth = 5, color = "black", fill = "white") +
  labs(title = "Histogram of deltaVolume_mm3cm2y", x = "deltaVolume_mm3cm2y", y = "Frequency")
```

## QA/QC of deltaDensity_mgcm3cm2y
Tags where deltaDensity_mgcm3cm2y = "NA":
```{r checkNADensity, echo=FALSE}
allBarData_clean$tagNum[which(is.na(allBarData_clean$deltaDensity_mgcm3cm2y))]
```
Historgram of deltaDensity_mgcm3cm2y values
```{r, echo=FALSE}
  ggplot(allBarData_clean, aes(x = deltaDensity_mgcm3cm2y)) +
  geom_histogram(binwidth = .1, color = "black", fill = "white") +
  labs(title = "Histogram of deltaDensity_mgcm3cm2y", x = "deltaDensity_mgcm3cm2y", y = "Frequency")
```


## QA/QC of macroboring_mm3cm2y
Tags where macroboring_mm3cm2y = "NA":
```{r checkNAMacroboring, echo=FALSE}
allBarData_clean$tagNum[which(is.na(allBarData_clean$macroboring_mm3cm2y))]
```
Historgram of macroboring_mm3cm2y values
```{r, echo=FALSE}
  ggplot(allBarData_clean, aes(x = macroboring_mm3cm2y)) +
  geom_histogram(binwidth = 1, color = "black", fill = "white") +
  labs(title = "Histogram of macroboring_mm3cm2y", x = "macroboring_mm3cm2y", y = "Frequency")
```

## QA/QC of accretion_mm3cm2y
Tags where accretion_mm3cm2y = "NA":
```{r checkNAAccretion, echo=FALSE}
allBarData_clean$tagNum[which(is.na(allBarData_clean$accretion_mm3cm2y))]
```
Historgram of accretion_mm3cm2y values
```{r, echo=FALSE}
  ggplot(allBarData_clean, aes(x = accretion_mm3cm2y)) +
  geom_histogram(binwidth = 5, color = "black", fill = "white") +
  labs(title = "Histogram of accretion_mm3cm2y", x = "accretion_mm3cm2y", y = "Frequency")
```

## QA/QC of grazing_mm3cm2y
Tags where grazing_mm3cm2y = "NA":
```{r checkNAGrazing, echo=FALSE}
allBarData_clean$tagNum[which(is.na(allBarData_clean$grazing_mm3cm2y))]
```
Historgram of grazing_mm3cm2y values
```{r, echo=FALSE}
  ggplot(allBarData_clean, aes(x = grazing_mm3cm2y)) +
  geom_histogram(binwidth = 5, color = "black", fill = "white") +
  labs(title = "Histogram of deltaVolume_mm3cm2y", x = "deltaVolume_mm3cm2y", y = "Frequency")
```
